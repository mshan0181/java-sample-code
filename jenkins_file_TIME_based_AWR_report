node ('master') {
     stage('Code_checkout') {
     git url: 'https://github.com/mshan0181/java-sample-code.git'
       }
    stage('SQL_script_runner_SNAPID_dynamic') {    
          step([$class: 'SQLPlusRunnerBuilder',credentialsId:'shandb-priv-id', instance:'client_access',scriptType:'file', script: 'DBID_SNAPID_info.sql',scriptContent: ''])         
        } 
    stage('SQL_script_runner_AWR_report') {   
           bat 'for /f "delims=" %%a in ('type C:\Users\Shanmugavelu\.jenkins\workspace\AWR_report_generation_TIME_based_daily_RUN\DB_id_info.log') do @set db_id_var=%%a'
           bat 'for /f "delims=" %%a in ('type C:\Users\Shanmugavelu\.jenkins\workspace\AWR_report_generation_TIME_based_daily_RUN\INST_no_info.log') do @set inst_num=%%a'
           bat 'for /f "delims=" %%a in ('type C:\Users\Shanmugavelu\.jenkins\workspace\AWR_report_generation_TIME_based_daily_RUN\snapid_BEGIN_id.log') do @set beg_id_var=%%a'
           bat 'for /f "delims=" %%a in ('type C:\Users\Shanmugavelu\.jenkins\workspace\AWR_report_generation_TIME_based_daily_RUN\snapid_END_id.log') do @set end_id_var=%%a'          
              bat 'echo define DB_ID=%db_id_var% > AWR_SQL_temp.sql' 
              bat 'echo define INSTANCE_NO=%inst_num% >> AWR_SQL_temp.sql'
              bat 'echo define BEGIN_ID=%beg_id_var% >> AWR_SQL_temp.sql'
              bat 'echo define END_ID=%end_id_var% >> AWR_SQL_temp.sql'
              bat 'type AWR_report.sql >> AWR_SQL_temp.sql'
            step([$class: 'SQLPlusRunnerBuilder',credentialsId:'shandb-priv-id', instance:'client_access',scriptType:'file', script: 'AWR_SQL_temp.sql',scriptContent: '']) 
           } 
     stage ('generate report') {
              publishHTML (target: [
              allowMissing: true,
              alwaysLinkToLastBuild: true,
              keepAll: true,
              reportDir: '',
              reportFiles: 'awr_from_console.html',
              reportName: "AWR-Report-for-Oracle-Database"
              ])
           }
  }
